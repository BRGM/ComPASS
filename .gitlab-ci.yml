# This file is a template, and might need editing before it works on your project.
# see https://docs.gitlab.com/ce/ci/yaml/README.html for all available options

# you can delete this line if you're not using Docker
#image: docker:latest

stages:
    #- build
    #- test
    #- deploy
    

# first build epos_gui image to run in docker.
before_script:
  - echo "Before script section"
  - docker info
   

after_script:
  - echo "After script section"
  - echo "For example you might do some cleanup here"

build:
   stage: build
   script:
    - docker build -t epos-gui-dev:latest -f gitlab/DockerFileTesting --build-arg SHORT_GIT_SHA=$SHORT_SHA .
    # - docker stop epos-gui-dev || true && docker rm epos-gui-dev || true
    # - docker run --rm -p 4200:80 --name epos-gui-dev -td epos-gui-dev:latest
   artifacts:
     expire_in: 1 month
     paths:
      - dist


deploy:
    stage: deploy
    script:
     - docker build -t epos-gui:latest --build-arg SHORT_GIT_SHA=$SHORT_SHA .
     - docker stop epos-gui || true && docker rm epos-gui || true
     - docker run --rm -p 8080:80 --name epos-gui -td epos-gui
    
unit test:
  stage: test
  script:
   - docker run --rm -td epos-gui-dev node_modules/.bin/ng test -sr --browsers PhantomJS

